window.VerJs=(function(){var a=function(){this.form;this.token="";this.messages={required:"当前选项不能为空！",min:0,max:0,minlength:0,maxlength:0,rule:"",equal:"",mobile:"请输入有效的手机号码",email:"请输入规则的电子邮箱",idcard:"请输入有效的身份证号码"};this.change;this.linkName="asset/need";this.error=function(e,f){this.clear_error(f);var c=f.getAttribute("data-block");f.classList.add("ver-error-input");var b=document.createElement("span");if(!c){var g=document.createElement("i");g.className="verJsFont ver-icon-carets ver-error-caret";b.appendChild(g);b.className="ver-errors"}else{b.className="ver-errors ver-errorMessageBlock"}var j=document.createElement("i");j.className="verJsFont icon-info-o";b.appendChild(j);var i=document.createElement("span");i.innerText=e;b.appendChild(i);this.insertAfter(b,f);var k=f.getAttribute("data-icon-color");if(k){var h=(f.offsetParent);var d=h.querySelector("iconcirle");d.classList.add("ver-error-inputs")}};this.insertAfter=function(d,b){var c=b.parentNode;if(c.lastChild==b){c.appendChild(d)}else{c.insertBefore(d,b.nextSibling)}};this.styles=function(){var b=document.createElement("link"),c=document.createElement("link");b.href=this.getPath+"need/common.css?v=1.0.2&$_="+Math.random();c.href=this.getPath+"need/vericon.css?v=1.0.2&$_="+Math.random();b.rel=c.rel="stylesheet";b.type=c.type="text/css";var d=document.getElementsByTagName("head")[0];d.appendChild(b);d.appendChild(c)};this.success=function(b){console.log(b)};this.fail=function(b){console.log(b)};this.signBase="md5";this.format="json"};a.prototype={getPath:function(){var b=document.currentScript?document.currentScript.src:function(){var e=document.scripts,d=e.length-1,f;for(var c=d;c>0;c--){if(e[c].readyState==="interactive"){f=e[c].src;break}}return f||e[d].src}();return b.substring(0,b.lastIndexOf("/")+1)}(),init:function(c){var b=this;this.styles();this.form=document.querySelector(c.form);if(!this.form){this.form=document.querySelector("form")}this.change=c.change?c.change:"default";this._sef_data(c.data,c.message);this.form.onsubmit=function(){return b.submit()};this.form.onreset=function(){return b.reset()};if(c.success){this.success=c.success}if(c.fail){this.fail=c.fail}if(c.api){this.api=c.api}if(c.signBase){this.signBase=c.signBase}if(c.apiToken){this.token=c.apiToken}if(c.format){this.format=c.format}},submit:function(){this.verification();var b=this.form.querySelectorAll(".ver-error-input").length;if(b>0){this.form.querySelector(".ver-error-input").focus();return false}var c=this.form.getAttribute("data-form");if(c=="ajax"){this.ajax();return false}else{if(c=="api"){this.ajax();return false}}return true},times:function(h){if(h=="timestmp"){return(new Date()).valueOf()}var e=new Date(),g=e.getFullYear(),i=e.getMonth()+1,c=e.getDate(),b=e.getHours(),d=e.getMinutes(),f=e.getSeconds();switch(h){case"Time":return(b<10?"0"+b:b)+":"+(d<10?"0"+d:d)+":"+(f<10?"0"+f:f);break;case"Date":return g+"-"+(i<10?"0"+i:i)+"-"+(c<10?"0"+c:c);break;default:return g+"-"+(i<10?"0"+i:i)+"-"+(c<10?"0"+c:c)+" "+(b<10?"0"+b:b)+":"+(d<10?"0"+d:d)+":"+(f<10?"0"+f:f);break}},reset:function(){this.form.reset();var b=this;for(var c in this.messages){var d=this.form.querySelectorAll("[data-"+c+"]");if(d.length>0){d.forEach(function(e){b.clear_error(e)})}}},_sef_data:function(e,d){var b=this;if(e){for(var c in e){var f=document.getElementsByName(c);f.forEach(function(i){for(var g in e[c]){var h=d&&d[c]&&d[c][g]?d[c][g]:b.messages[g];if(g!="min"&&g!="max"&&g!="minlength"&&g!="maxlength"&&g!="rule"&&g!="equal"){i.setAttribute("data-"+g,h)}else{if(g=="rule"){i.setAttribute("data-rule",e[c][g]);i.setAttribute("data-rule-message",h)}else{i.setAttribute("data-"+g,e[c][g])}}}})}}for(var c in this.messages){var f=this.form.querySelectorAll("[data-"+c+"]");f.forEach(function(g){var h=g.getAttribute("data-"+c);if(h=="true"||h=="false"){g.setAttribute("data-"+c,b.messages[c])}g.onblur=function(){b.query(this)};g.change=function(){b.query(this)};g.onfocus=function(){b.clear_error(this)};if(b.change=="keyup"){g.onkeyup=function(){b.query(this)}}})}},verification:function(){var b=this;for(var c in this.messages){var d=this.form.querySelectorAll("[data-"+c+"]");if(d.length>0){d.forEach(function(e){b.query(e)})}}},query:function(l){var f={required:h,min:d,max:d,minlength:c,maxlength:c,rule:k,equal:j,mobile:b,email:g,idcard:e};var i=this;for(var m in f){if(l.getAttribute("data-"+m)){f[m]()}}function h(){var o=l.value,n=l.getAttribute("data-required");if(o==""||o==null){i.error(n,l);return false}return true}function d(){var p=(l.value),o=parseInt(l.getAttribute("data-min")),n=parseInt(l.getAttribute("data-max"));p=parseInt(p);if(p){if(isNaN(p)||o>p){i.error("最小值为："+o,l);return false}else{if(!isNaN(n)&&n<p){i.error("最大值为："+n,l);return false}}}return true}function c(){var p=l.value.length,n=parseInt(l.getAttribute("data-maxlength")),o=parseInt(l.getAttribute("data-minlength"));if(p<o){i.error("最少输入"+o+"个字符",l);return false}else{if(p>n){i.error("最多输入"+n+"个字符",l);return false}}return true}function k(){var o=l.value,p=l.getAttribute("data-rule"),n=l.getAttribute("data-rule-message");
        if(!n){n="格式错误!"}p=new RegExp(p);if(o){if(!p.test(o)){i.error(n,l);return false}}return true}function j(){var p=l.value,o=document.querySelector(l.getAttribute("data-equal")).value,n="两次输入内容不一致";if(p!=o){i.error(n,l);return false}return true}function b(){var q=l.value,o=/^(0\d{2,3}\d{7,8}|0\d{2,3}-)\d{7,8}$/,n=/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,p=l.getAttribute("data-mobile");if(q&&!n.test(q)&&!o.test(q)){i.error(p,l);return false}return true}function g(){var p=l.value,n=/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,o=l.getAttribute("data-email");if(p&&!n.test(p)){i.error(o,l);return false}return true}function e(){var p=l.value,n=/^([1-9]\d{5}[1]\d{3}(0[1-9]|1[0-2])(0[1-9]|[1-2]\d|3[0-1])\d{3}[0-9xX]|[1-9]\d{5}\d{2}(0[1-9]|1[0-2])(0[1-9]|[1-2]\d|3[0-1])\d{3})$/,o=l.getAttribute("data-idcard");if(p&&!n.test(p)){i.error(o,l);return false}return true}},clear_error:function(e){var d=e.parentNode,f=d.querySelector(".ver-errors");if(f){d.removeChild(f)}e.classList.remove("ver-error-input");var b=e.getAttribute("data-icon-color");if(b){var d=(e.offsetParent);var c=d.querySelector("iconcirle");c.classList.remove("ver-error-inputs")}},ajax:function(){var d=this.form.getAttribute("data-form");var c=this;var f=new XMLHttpRequest();f.open("POST",this.form.action,true);f.setRequestHeader("x-requested-with","XMLHttpRequest");var e=this.formData();if(d=="api"){f.setRequestHeader("Content-Type","application/json; charset=UTF-8");var e=this.apis();var b={header:{method:this.api,time:this.times(),sign:this.my_sign(e),base:this.signBase,format:this.format},body:e};e=b;e=JSON.stringify(e)}f.onreadystatechange=function(){if(f.readyState==4){if(f.status==203){return false}else{if(f.status==200||f.status==304){c.success(f.responseText)}else{c.fail(f.responseText)}}}};f.send(e)},my_sign:function(b){b=this.keySort(b);if(this.signBase=="md5"){return hex_md5(b+this.token,"utf-8")}},keySort:function(f){try{var b=Object.keys(f).sort();var c="";for(var d in b){var j=f[b[d]].toString();if(this.validateHtmlTag(j)){j=j.replace(/<[^>]+>/g,"")}var h=j.match(/[\u4e00-\u9fa5]+/g);if(h){j=encodeURIComponent(j)}if(j.length>1&&j.length<180){c+=b[d]+j}}return c}catch(g){return g}},apis:function(){var e={},d=this.form.querySelectorAll("input"),c=this.form.querySelectorAll("select"),f=this.form.querySelectorAll("textarea"),b=this;if(d.length>0){d.forEach(function(g){var h=g.type.toLowerCase();if(h!="checkbox"&&h!="radio"){e[g.name]=g.value}else{if(g.checked){e[g.name]=(g.value)}}})}if(c.length>0){c.forEach(function(g){e[g.name]=g.value})}if(f.length>0){f.forEach(function(g){e[g.name]=g.value})}return e},formData:function(){var d=[],c=this.form.querySelectorAll("input"),b=this.form.querySelectorAll("select"),e=this.form.querySelectorAll("textarea");if(c.length>0){c.forEach(function(f){var g=f.type.toLowerCase(),h="";if(g!=="checkbox"&&g!="radio"){h=f.name+"="+f.value}else{if(f.checked){h=f.name+"="+f.value}}if(h){d.push(h)}})}if(b.length>0){b.forEach(function(f){d.push(f.name+"="+f.value)})}if(e.length>0){e.forEach(function(f){d.push(f.name+"="+f.value)})}return encodeURI(d.join("&"))},validateHtmlTag:function(c){var b=/<(?:(?:\/?[A-Za-z]\w*\b(?:[=\s](['"]?)[\s\S]*?\1)*)|(?:!--[\s\S]*?--))\/?>/g;return c.match(b)}};return a})();